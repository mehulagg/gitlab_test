stages:
  - build
  - test
  - review
  - deploy

# build and test stages
include:
  - template: Jobs/Build.gitlab-ci.yml
  - template: Jobs/Test.gitlab-ci.yml

# review stage
.deploy_to_ecs:
  image: registry.gitlab.com/gitlab-org/cloud-deploy:latest
  script:
    - ecs update-task-definition

# review stage
deploy review app:
  extends: .deploy_to_ecs
  stage: review
  only:
    refs:
      - branches
      - tags

# deploy stage
deploy:
  extends: .deploy_to_ecs
  stage: deploy
  only:
    refs:
      - master
