# Read more about the feature here: https://docs.gitlab.com/ee/user/project/merge_requests/accessibility_testing.html

stages:
  - build
  - test
  - deploy
  - accessibility

a11y:
  stage: accessibility
  image: "registry.gitlab.com/gitlab-org/ci-cd/accessibility:latest"
  script:
    - mkdir /reports
    - pwd
    - ls
    - cat /pa11y.json
    - for url in $a11y_urls; do filename=$(echo $url | sed -E 's/https?:\/\///'); /node_modules/.bin/pa11y --config /pa11y.json $url > /reports/$filename-accessibility.html; done
    - ls /reports
    - ls /reports/*-accessibility.html
  allow_failure: true
  # artifacts:
  #   when: always
  #   paths:
  #     - /reports/*-accessibility.html
  rules:
    - if: $a11y_urls
