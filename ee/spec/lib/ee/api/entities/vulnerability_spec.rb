# frozen_string_literal: true

require 'spec_helper'

describe EE::API::Entities::Vulnerability do
  let(:vulnerability) { create(:vulnerability, findings: [finding]) }

  let(:finding) do
    create(
      :vulnerabilities_occurrence,
      raw_metadata: {
        location: location
      }.to_json
    )
  end

  let(:location) do
    {
      'end_line' => 666,
      'file' => 'vulnerable-file.js',
      'start_line' => 420
    }
  end

  subject { described_class.new(vulnerability).as_json }

  it "exposes a link to the vulnerability's detail page" do
    expect(subject[:vulnerability_path]).to eq(
      Gitlab::Routing.url_helpers.project_security_vulnerability_path(vulnerability.project, vulnerability)
    )
  end

  it 'exposes the location from the related finding' do
    expect(subject[:location]).to eq(location)
  end
end
